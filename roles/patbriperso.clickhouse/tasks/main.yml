---
- name: Install prerequisite packages
  ansible.builtin.apt:
    name:
      - apt-transport-https
      - ca-certificates
      - curl
      - gnupg
    state: present
    update_cache: yes

- name: Add ClickHouse GPG key
  ansible.builtin.get_url:
    url: "{{ clickhouse_keyring_url }}"
    dest: "{{ clickhouse_keyring_path }}"
    mode: "0644"
    force: false

- name: Add ClickHouse APT repository
  ansible.builtin.apt_repository:
    repo: >-
      deb [signed-by={{ clickhouse_keyring_path }}]
      {{ clickhouse_repo_url }}
      {{ clickhouse_repo_distribution }}
      {{ clickhouse_repo_component }}
    filename: clickhouse
    state: present
    update_cache: yes

- name: Install ClickHouse client
  ansible.builtin.apt:
    name: "{{ clickhouse_packages }}"
    state: present
